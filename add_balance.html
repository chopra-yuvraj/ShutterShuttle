<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Balance - ShutterShuttle</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'navy-dark': '#0F172A',
                        'navy-light': '#1E293B',
                        'teal-accent': '#2DD4BF',
                        'teal-hover': '#14B8A6',
                        'gray-text': '#CBD5E1',
                        'gray-heading': '#F1F5F9',
                    }
                }
            }
        }
    </script>
    <style>
        .modal-backdrop {
            position: fixed; 
            inset: 0; 
            background: rgba(0,0,0,0.6);
            display: flex; 
            align-items: center; 
            justify-content: center; 
            z-index: 50;
        }
        .modal {
            background: #1E293B; 
            padding: 1.5rem; 
            border-radius: 0.75rem;
            width: 24rem; 
            box-shadow: 0 10px 25px rgba(0,0,0,0.5);
            border: 1px solid #2DD4BF;
        }
        .modal-header { 
            font-size: 1.25rem; 
            font-weight: 600; 
            color: #F1F5F9; 
            text-align: center;
            margin-bottom: 1rem;
        }
        .modal-content { 
            margin-top: 1rem; 
            color: #CBD5E1; 
        }
        .modal-footer { 
            margin-top: 1.5rem; 
            text-align: right; 
        }
        .btn { 
            padding: 0.5rem 1rem; 
            border-radius: 0.375rem; 
            font-weight: 600; 
            cursor: pointer;
        }
        .btn-primary { 
            background: #2DD4BF; 
            color: #0F172A; 
        }
        .btn-primary:hover { 
            background: #14B8A6; 
        }
        .btn-secondary { 
            background: transparent; 
            color: #CBD5E1; 
            border: 1px solid #CBD5E1; 
        }
        .btn-secondary:hover { 
            background: #334155; 
        }
        .razorpay-logo {
            color: #2DD4BF;
            font-weight: bold;
            font-size: 1.1rem;
        }
    </style>
</head>
<body class="bg-navy-dark text-gray-text min-h-screen flex items-center justify-center">
    <div class="bg-navy-light p-8 rounded-xl border border-teal-accent/20 w-full max-w-md">
        <h1 class="text-2xl font-bold text-teal-accent mb-4">Add Balance</h1>
        <p class="text-gray-text mb-6">Secure payment powered by Razorpay (Demo)</p>
        
        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                {% if category == 'success' %}
                    <div class="p-3 mb-4 rounded bg-green-900/20 border border-green-500/30 text-green-400">
                        {{ message }}
                    </div>
                {% else %}
                    <div class="p-3 mb-4 rounded bg-red-900/20 border border-red-500/30 text-red-400">
                        {{ message }}
                    </div>
                {% endif %}
            {% endfor %}
        {% endif %}
        {% endwith %}
        
        <div class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-gray-text mb-2">Select Amount (‚Çπ)</label>
                <select id="amount" class="w-full p-3 bg-navy-dark border border-gray-600 rounded text-gray-text focus:outline-none focus:ring-teal-accent focus:border-teal-accent">
                    <option value="50">‚Çπ50</option>
                    <option value="100">‚Çπ100</option>
                    <option value="200">‚Çπ200</option>
                    <option value="500">‚Çπ500</option>
                    <option value="1000">‚Çπ1000</option>
                </select>
            </div>
            
            <button id="payBtn" class="w-full bg-teal-accent text-navy-dark font-semibold py-3 rounded hover:bg-teal-hover transition">
                Pay with Razorpay
            </button>
        </div>
        
        <div class="mt-6 text-center">
            <a href="{{ url_for('student_dashboard') }}" class="text-teal-accent hover:text-teal-hover">‚Üê Back to Dashboard</a>
        </div>
        
        <div class="mt-4 p-3 bg-blue-900/20 border border-blue-500/30 rounded">
            <p class="text-blue-300 text-sm">üí≥ This is a demo version of Razorpay payment gateway</p>
        </div>
    </div>

    <!-- Demo Payment Modal -->
    <div id="modal" class="modal-backdrop hidden">
        <div class="modal">
            <div class="modal-header">
                <div class="razorpay-logo">Razorpay</div>
                <div class="text-sm text-gray-400">Secure Checkout</div>
            </div>
            
            <div class="modal-content">
                <div class="mb-4 p-3 bg-navy-dark rounded">
                    <p class="text-sm"><strong>Merchant:</strong> ShutterShuttle</p>
                    <p class="text-sm"><strong>Order ID:</strong> <span id="modal-order-id"></span></p>
                    <p class="text-lg font-semibold text-teal-accent">Amount: ‚Çπ<span id="modal-amount"></span></p>
                </div>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm text-gray-heading mb-1">Card Number</label>
                        <input type="text" value="4242 4242 4242 4242" disabled class="w-full p-2 bg-navy-dark border border-gray-600 rounded text-gray-text text-center" />
                        <p class="text-xs text-gray-400 mt-1">Demo card (always succeeds)</p>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm text-gray-heading mb-1">Expiry</label>
                            <input type="text" value="12/34" disabled class="w-full p-2 bg-navy-dark border border-gray-600 rounded text-gray-text text-center" />
                        </div>
                        <div>
                            <label class="block text-sm text-gray-heading mb-1">CVV</label>
                            <input type="text" value="123" disabled class="w-full p-2 bg-navy-dark border border-gray-600 rounded text-gray-text text-center" />
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button id="cancelBtn" class="btn btn-secondary mr-2">Cancel</button>
                <button id="confirmBtn" class="btn btn-primary">Pay ‚Çπ<span id="modal-amount-footer"></span></button>
            </div>
        </div>
    </div>

    <!-- Hidden form for payment submission -->
    <form id="demo-form" action="{{ url_for('verify_payment') }}" method="POST" style="display:none;">
        <input name="amount" id="hidden_amount">
    </form>

    <script>
        const payBtn = document.getElementById('payBtn');
        const modal = document.getElementById('modal');
        const cancelBtn = document.getElementById('cancelBtn');
        const confirmBtn = document.getElementById('confirmBtn');
        const amountSelect = document.getElementById('amount');
        const modalAmt = document.getElementById('modal-amount');
        const modalAmtFooter = document.getElementById('modal-amount-footer');
        const modalOrderID = document.getElementById('modal-order-id');
        const hiddenForm = document.getElementById('demo-form');
        const hiddenAmount = document.getElementById('hidden_amount');

        async function createDemoOrder(amount) {
            const resp = await fetch('/create_payment_order', {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: `amount=${amount}`
            });
            return await resp.json();
        }

        payBtn.addEventListener('click', async () => {
            const amt = amountSelect.value;
            payBtn.textContent = 'Processing...';
            payBtn.disabled = true;
            
            try {
                const data = await createDemoOrder(amt);
                if (!data.success) {
                    alert('Error: ' + data.error);
                    return;
                }
                
                modalAmt.textContent = (data.amount / 100).toFixed(2);
                modalAmtFooter.textContent = (data.amount / 100).toFixed(2);
                modalOrderID.textContent = data.order_id;
                hiddenAmount.value = data.amount;
                modal.classList.remove('hidden');
                
            } catch (error) {
                alert('Network error: ' + error.message);
            } finally {
                payBtn.textContent = 'Pay with Razorpay';
                payBtn.disabled = false;
            }
        });

        cancelBtn.addEventListener('click', () => {
            modal.classList.add('hidden');
        });

        confirmBtn.addEventListener('click', () => {
            confirmBtn.textContent = 'Processing...';
            confirmBtn.disabled = true;
            hiddenForm.submit();
        });

        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                modal.classList.add('hidden');
            }
        });
    </script>
</body>
</html>
